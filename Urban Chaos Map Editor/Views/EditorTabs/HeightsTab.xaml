<UserControl x:Class="UrbanChaosMapEditor.Views.EditorTabs.HeightsTab"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="clr-namespace:UrbanChaosMapEditor.ViewModels">

    <ScrollViewer VerticalScrollBarVisibility="Auto">
        <StackPanel Margin="8" Orientation="Vertical">

            <!-- ===================== TERRAIN HEIGHT TOOLS ===================== -->
            <TextBlock Text="Terrain Heights" FontWeight="SemiBold" Margin="0,0,0,6"/>
            <TextBlock Text="Vertex height offsets for hills and terrain" 
                       Opacity="0.6" FontSize="11" Margin="0,0,0,8"/>

            <!-- Units / step size -->
            <StackPanel Orientation="Horizontal" Margin="0,0,0,8" VerticalAlignment="Center">
                <TextBlock Text="Units:" VerticalAlignment="Center" Margin="0,0,6,0"/>
                <TextBox Width="64"
                         Text="{Binding Map.HeightStep, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                         HorizontalContentAlignment="Right"
                         PreviewTextInput="Units_PreviewTextInput"
                         DataObject.Pasting="Units_OnPaste"/>

                <TextBlock Text="  Brush:" VerticalAlignment="Center" Margin="12,0,6,0"/>
                <Slider Width="50"
                        Height="22"
                        Minimum="1" Maximum="10"
                        TickFrequency="1"
                        IsSnapToTickEnabled="True"
                        Value="{Binding Map.BrushSize, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                <TextBlock Text="{Binding Map.BrushSize}"
                           VerticalAlignment="Center"
                           Margin="4,0,0,0"
                           Width="22"
                           TextAlignment="Right"/>
            </StackPanel>

            <WrapPanel>
                <!-- Raise -->
                <Button Margin="0,0,6,6" Padding="6,6"
                        ToolTip="{Binding Map.HeightStep, StringFormat=Raise by {0}}"
                        Command="{Binding Map.RaiseHeightCommand}">
                    <StackPanel Orientation="Vertical" HorizontalAlignment="Center">
                        <Image Source="/Assets/Icons/raise.ico" Width="24" Height="24" Stretch="Uniform"/>
                        <TextBlock Text="Raise" HorizontalAlignment="Center" Margin="0,4,0,0"/>
                    </StackPanel>
                </Button>

                <!-- Lower -->
                <Button Margin="0,0,6,6" Padding="6,6"
                        ToolTip="{Binding Map.HeightStep, StringFormat=Lower by {0}}"
                        Command="{Binding Map.LowerHeightCommand}">
                    <StackPanel Orientation="Vertical" HorizontalAlignment="Center">
                        <Image Source="/Assets/Icons/lower.ico" Width="24" Height="24" Stretch="Uniform"/>
                        <TextBlock Text="Lower" HorizontalAlignment="Center" Margin="0,4,0,0"/>
                    </StackPanel>
                </Button>

                <!-- Level -->
                <Button Margin="0,0,6,6" Padding="6,6"
                        ToolTip="Level: click then drag to copy height to other tiles"
                        Command="{Binding Map.LevelHeightCommand}">
                    <StackPanel Orientation="Vertical" HorizontalAlignment="Center">
                        <Image Source="/Assets/Icons/level.ico" Width="24" Height="24" Stretch="Uniform"/>
                        <TextBlock Text="Level" HorizontalAlignment="Center" Margin="0,4,0,0"/>
                    </StackPanel>
                </Button>

                <!-- Flatten -->
                <Button Margin="0,0,6,6" Padding="6,6"
                        ToolTip="Flatten: set height to 0"
                        Command="{Binding Map.FlattenHeightCommand}">
                    <StackPanel Orientation="Vertical" HorizontalAlignment="Center">
                        <Image Source="/Assets/Icons/flatten.ico" Width="24" Height="24" Stretch="Uniform"/>
                        <TextBlock Text="Flatten" HorizontalAlignment="Center" Margin="0,4,0,0"/>
                    </StackPanel>
                </Button>
            </WrapPanel>

            <Separator Margin="0,8,0,8"/>
            <TextBlock Text="Templates" FontWeight="SemiBold" Margin="0,0,0,6"/>

            <WrapPanel>
                <!-- Ditch template -->
                <Button Margin="0,0,6,6" Padding="6,6"
                        ToolTip="Ditch template: click to stamp pattern"
                        Command="{Binding Map.DitchTemplateCommand}">
                    <StackPanel Orientation="Vertical" HorizontalAlignment="Center">
                        <Image Source="/Assets/Icons/ditch.ico" Width="24" Height="24" Stretch="Uniform"/>
                        <TextBlock Text="Ditch" HorizontalAlignment="Center" Margin="0,4,0,0"/>
                    </StackPanel>
                </Button>
            </WrapPanel>

            <Separator Margin="0,8,0,8"/>




            <!-- Global terrain -->
            <TextBlock Text="Global" FontWeight="SemiBold" Margin="0,0,0,6"/>
            <WrapPanel>
                <Button Margin="0,0,6,6" Padding="6,6"
                        ToolTip="Randomise all heights to a natural-looking terrain"
                        Command="{Binding RandomizeHeightsCommand}">
                    <StackPanel Orientation="Vertical" HorizontalAlignment="Center">
                        <Image Source="/Assets/Icons/randomizeterrain.ico" Width="24" Height="24" Stretch="Uniform"/>
                        <TextBlock Text="Randomise" HorizontalAlignment="Center" Margin="0,4,0,0"/>
                    </StackPanel>
                </Button>
            </WrapPanel>

            <!-- ===================== CELL ALTITUDE TOOLS ===================== -->
            <Separator Margin="0,12,0,12"/>

            <TextBlock Text="Cell Altitude (Floor Level)" FontWeight="SemiBold" Margin="0,0,0,6"/>
            <TextBlock Text="Set the base altitude of floor cells for roofs and elevated areas" 
                       Opacity="0.6" FontSize="11" Margin="0,0,0,8" TextWrapping="Wrap"/>

            <!-- Manual altitude input -->
            <StackPanel Orientation="Horizontal" Margin="0,0,0,8" VerticalAlignment="Center">
                <TextBlock Text="Altitude:" VerticalAlignment="Center" Margin="0,0,6,0"/>
                <TextBox x:Name="AltitudeInput" Width="64"
                         Text="{Binding Map.TargetAltitude, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, FallbackValue=0}"
                         HorizontalContentAlignment="Right"
                         PreviewTextInput="Altitude_PreviewTextInput"
                         DataObject.Pasting="Altitude_OnPaste"
                         ToolTip="World altitude value (stored as value / 8)"/>
                <TextBlock Text="  (raw:" VerticalAlignment="Center" Margin="8,0,2,0" Opacity="0.6"/>
                <TextBlock x:Name="RawAltitudeDisplay" 
                           Text="{Binding Map.TargetAltitudeRaw, FallbackValue=0}"
                           VerticalAlignment="Center" 
                           Opacity="0.6"/>
                <TextBlock Text=")" VerticalAlignment="Center" Opacity="0.6"/>
            </StackPanel>

            <WrapPanel>
                <!-- Set Altitude -->
                <Button x:Name="SetAltitudeButton" Margin="0,0,6,6" Padding="6,6"
                        ToolTip="Set Altitude: click cells to set their floor altitude"
                        Click="SetAltitude_Click">
                    <StackPanel Orientation="Vertical" HorizontalAlignment="Center">
                        <Grid Width="24" Height="24">
                            <Rectangle Fill="#4488CC" RadiusX="2" RadiusY="2"/>
                            <TextBlock Text="A" FontWeight="Bold" FontSize="14" 
                                       Foreground="White" 
                                       HorizontalAlignment="Center" 
                                       VerticalAlignment="Center"/>
                        </Grid>
                        <TextBlock Text="Set Alt" HorizontalAlignment="Center" Margin="0,4,0,0"/>
                    </StackPanel>
                </Button>

                <!-- Sample Altitude -->
                <Button x:Name="SampleAltitudeButton" Margin="0,0,6,6" Padding="6,6"
                        ToolTip="Sample Altitude: click a cell to read its altitude"
                        Click="SampleAltitude_Click">
                    <StackPanel Orientation="Vertical" HorizontalAlignment="Center">
                        <Grid Width="24" Height="24">
                            <Rectangle Fill="#44CC88" RadiusX="2" RadiusY="2"/>
                            <TextBlock Text="?" FontWeight="Bold" FontSize="14" 
                                       Foreground="White" 
                                       HorizontalAlignment="Center" 
                                       VerticalAlignment="Center"/>
                        </Grid>
                        <TextBlock Text="Sample" HorizontalAlignment="Center" Margin="0,4,0,0"/>
                    </StackPanel>
                </Button>

                <!-- Reset Altitude -->
                <Button x:Name="ResetAltitudeButton" Margin="0,0,6,6" Padding="6,6"
                        ToolTip="Reset Altitude: click cells to set their altitude back to 0"
                        Click="ResetAltitude_Click">
                    <StackPanel Orientation="Vertical" HorizontalAlignment="Center">
                        <Grid Width="24" Height="24">
                            <Rectangle Fill="#CC4444" RadiusX="2" RadiusY="2"/>
                            <TextBlock Text="0" FontWeight="Bold" FontSize="14" 
                                       Foreground="White" 
                                       HorizontalAlignment="Center" 
                                       VerticalAlignment="Center"/>
                        </Grid>
                        <TextBlock Text="Reset" HorizontalAlignment="Center" Margin="0,4,0,0"/>
                    </StackPanel>
                </Button>
            </WrapPanel>

            <!-- ===================== ROOF BUILDING ===================== -->
            <Separator Margin="0,12,0,12"/>

            <TextBlock Text="Automatic Roof Building" FontWeight="SemiBold" Margin="0,0,0,6"/>
            <TextBlock Text="Detect closed facet shapes and set interior cell altitudes" 
                       Opacity="0.6" FontSize="11" Margin="0,0,0,8" TextWrapping="Wrap"/>

            <WrapPanel>
                <!-- Build Roof from Selection -->
                <Button x:Name="BuildRoofButton" Margin="0,0,6,6" Padding="6,6"
                        ToolTip="Build Roof: use selected facets to create a roof surface"
                        Click="BuildRoof_Click">
                    <StackPanel Orientation="Vertical" HorizontalAlignment="Center">
                        <Grid Width="24" Height="24">
                            <Rectangle Fill="#8844CC" RadiusX="2" RadiusY="2"/>
                            <TextBlock Text="R" FontWeight="Bold" FontSize="14" 
                                       Foreground="White" 
                                       HorizontalAlignment="Center" 
                                       VerticalAlignment="Center"/>
                        </Grid>
                        <TextBlock Text="Build Roof" HorizontalAlignment="Center" Margin="0,4,0,0"/>
                    </StackPanel>
                </Button>

                <!-- Detect Near Point -->
                <Button x:Name="DetectRoofButton" Margin="0,0,6,6" Padding="6,6"
                        ToolTip="Detect Roof: click in map to find closed shapes nearby"
                        Click="DetectRoof_Click">
                    <StackPanel Orientation="Vertical" HorizontalAlignment="Center">
                        <Grid Width="24" Height="24">
                            <Rectangle Fill="#CC8844" RadiusX="2" RadiusY="2"/>
                            <TextBlock Text="D" FontWeight="Bold" FontSize="14" 
                                       Foreground="White" 
                                       HorizontalAlignment="Center" 
                                       VerticalAlignment="Center"/>
                        </Grid>
                        <TextBlock Text="Detect" HorizontalAlignment="Center" Margin="0,4,0,0"/>
                    </StackPanel>
                </Button>
            </WrapPanel>

            <!-- Analysis result display -->
            <Border x:Name="AnalysisResultBorder" 
                    Background="#20000000" 
                    CornerRadius="4" 
                    Padding="8" 
                    Margin="0,8,0,0"
                    Visibility="Collapsed">
                <StackPanel>
                    <TextBlock x:Name="AnalysisResultText" 
                               TextWrapping="Wrap" 
                               FontSize="11"/>
                    <Button x:Name="ApplyDetectedRoofButton"
                            Content="Apply Detected Roof"
                            Margin="0,8,0,0"
                            Click="ApplyDetectedRoof_Click"
                            Visibility="Collapsed"/>
                </StackPanel>
            </Border>

            <Separator Margin="0,12,0,6"/>

            <TextBlock Text="Click in the map to apply. Ctrl+Wheel zooms. Ctrl+0 resets."
                       Opacity="0.7" TextWrapping="Wrap"/>
        </StackPanel>
    </ScrollViewer>
</UserControl>
