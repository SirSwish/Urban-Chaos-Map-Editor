<UserControl x:Class="UrbanChaosMapEditor.Views.EditorTabs.PrimsTab"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:models="clr-namespace:UrbanChaosMapEditor.Models">
    <!-- Inherit DataContext from MainWindow -->

    <Grid Margin="8">
        <Grid.RowDefinitions>
            <RowDefinition Height="0.35*"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="0.65*"/>
        </Grid.RowDefinitions>

        <!-- Placed objects list -->
        <ListView x:Name="PrimsList"
                  Grid.Row="0"
                  ItemsSource="{Binding Map.Prims}"
                  SelectedItem="{Binding Map.SelectedPrim, Mode=TwoWay}"
                  MouseDoubleClick="PrimsList_MouseDoubleClick"
                  PreviewKeyDown="PrimsList_PreviewKeyDown"
                  Foreground="White"
                  Background="#2b2b2b">
            <ListView.Resources>
                <Style TargetType="GridViewColumnHeader">
                    <Setter Property="Background" Value="#444"/>
                    <Setter Property="Foreground" Value="White"/>
                    <Setter Property="FontWeight" Value="SemiBold"/>
                    <Setter Property="HorizontalContentAlignment" Value="Left"/>
                </Style>
            </ListView.Resources>

            <!-- Use the VM command already in your DataContext -->
            <ListView.InputBindings>
                <KeyBinding Key="Delete"
                            Command="{Binding DataContext.DeletePrimCommand,
                                              RelativeSource={RelativeSource AncestorType=UserControl}}" />
            </ListView.InputBindings>

            <ListView.View>
                <GridView>
                    <GridViewColumn Header=""
                                    DisplayMemberBinding="{Binding Name}"
                                    Width="320"/>
                </GridView>
            </ListView.View>
        </ListView>

        <!-- Action buttons -->
        <Border Grid.Row="1" Background="#2b2b2b" Padding="6" Margin="0,6,0,6">
            <WrapPanel Orientation="Horizontal" ItemHeight="Auto" ItemWidth="Auto">

                <!-- Properties -->
                <Button x:Name="BtnPrimProps" Width="45" Height="40" Click="PrimProperties_Click">
                    <Button.ToolTip>
                        <TextBlock Text="Properties"/>
                    </Button.ToolTip>
                    <Image Source="/Assets/Icons/objectproperties.ico" Width="32" Height="32" Stretch="Uniform"/>
                </Button>

                <!-- Height -->
                <Button x:Name="BtnPrimHeight" Width="45" Height="40" Margin="6,0,0,0" Click="PrimHeight_Click">
                    <Button.ToolTip>
                        <TextBlock Text="Height"/>
                    </Button.ToolTip>
                    <Image Source="/Assets/Icons/showprimheight.ico" Width="32" Height="32" Stretch="Uniform"/>
                </Button>

                <!-- Delete -->
                <Button x:Name="DeletePrimBtn"
                    Width="45"
                    Height="40"
                    Margin="6,0,0,0"
                    Click="DeletePrim_Click"
                    IsEnabled="{Binding SelectedItem, ElementName=PrimsList, Converter={StaticResource NullToBool}}">
                                <Button.ToolTip>
                                    <TextBlock Text="Delete selected prim"/>
                                </Button.ToolTip>
                                <Image Source="/Assets/Icons/delete.ico"
                       Width="32"
                       Height="32"
                       Stretch="Uniform"/>
                </Button>

            </WrapPanel>
        </Border>

        <!-- Prim palette by category -->
        <Border Grid.Row="2" Background="#262626" BorderBrush="#444" BorderThickness="1">
            <TabControl Background="#262626">
                <TabControl.Resources>
                    <ItemsPanelTemplate x:Key="PrimWrapPanel">
                        <WrapPanel Orientation="Horizontal" ItemWidth="56" ItemHeight="56"/>
                    </ItemsPanelTemplate>

                    <DataTemplate x:Key="PrimButtonTemplate">
                        <Button Width="56" Height="56"
            Margin="4" Padding="0"
            Click="PrimPalette_Click"
            Tag="{Binding}"
            Background="Transparent"
            BorderBrush="Transparent"
            HorizontalContentAlignment="Center"
            VerticalContentAlignment="Center">
                            <ToolTipService.ToolTip>
                                <TextBlock>
                <Run Text="{Binding Number, StringFormat={}{0:D3}}"/>
                <Run Text=" - "/>
                <Run Text="{Binding Title}"/>
                                </TextBlock>
                            </ToolTipService.ToolTip>

                            <Grid>
                                <!-- Rounded tile background -->
                                <Border Background="#222"
                    BorderBrush="#444"
                    BorderThickness="1"
                    CornerRadius="8"
                    SnapsToDevicePixels="True"/>

                                <!-- Icon, clipped to the same rounded shape -->
                                <Image Source="{Binding Icon}"
                   Margin="2"
                   Stretch="Uniform"
                   RenderOptions.BitmapScalingMode="NearestNeighbor">
                                    <Image.Clip>
                                        <!-- 56x56 button, 2px margin each side -> 52x52 clip -->
                                        <RectangleGeometry Rect="0,0,52,52"
                                       RadiusX="8"
                                       RadiusY="8" />
                                    </Image.Clip>
                                </Image>
                            </Grid>
                        </Button>
                    </DataTemplate>

                </TabControl.Resources>

                <!-- CITY ASSETS -->
                <TabItem Header="City">
                    <ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
                        <ItemsControl ItemsSource="{Binding Map.PrimButtons}"
                                      ItemTemplate="{StaticResource PrimButtonTemplate}">
                            <ItemsControl.ItemsPanel>
                                <ItemsPanelTemplate>
                                    <WrapPanel Orientation="Horizontal"/>
                                </ItemsPanelTemplate>
                            </ItemsControl.ItemsPanel>
                            <ItemsControl.ItemContainerStyle>
                                <Style TargetType="ContentPresenter">
                                    <Setter Property="Visibility" Value="Collapsed"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding Category}" Value="{x:Static models:PrimButtonCategory.CityAssets}">
                                            <Setter Property="Visibility" Value="Visible"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </ItemsControl.ItemContainerStyle>
                        </ItemsControl>
                    </ScrollViewer>
                </TabItem>

                <!-- VEHICLES -->
                <TabItem Header="Vehicles">
                    <ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
                        <ItemsControl ItemsSource="{Binding Map.PrimButtons}"
                                      ItemTemplate="{StaticResource PrimButtonTemplate}">
                            <ItemsControl.ItemsPanel>
                                <ItemsPanelTemplate>
                                    <WrapPanel Orientation="Horizontal"/>
                                </ItemsPanelTemplate>
                            </ItemsControl.ItemsPanel>
                            <ItemsControl.ItemContainerStyle>
                                <Style TargetType="ContentPresenter">
                                    <Setter Property="Visibility" Value="Collapsed"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding Category}" Value="{x:Static models:PrimButtonCategory.Vehicles}">
                                            <Setter Property="Visibility" Value="Visible"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </ItemsControl.ItemContainerStyle>
                        </ItemsControl>
                    </ScrollViewer>
                </TabItem>

                <!-- FURNITURE -->
                <TabItem Header="Furniture">
                    <ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
                        <ItemsControl ItemsSource="{Binding Map.PrimButtons}"
                                      ItemTemplate="{StaticResource PrimButtonTemplate}">
                            <ItemsControl.ItemsPanel>
                                <ItemsPanelTemplate>
                                    <WrapPanel Orientation="Horizontal"/>
                                </ItemsPanelTemplate>
                            </ItemsControl.ItemsPanel>
                            <ItemsControl.ItemContainerStyle>
                                <Style TargetType="ContentPresenter">
                                    <Setter Property="Visibility" Value="Collapsed"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding Category}" Value="{x:Static models:PrimButtonCategory.Furniture}">
                                            <Setter Property="Visibility" Value="Visible"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </ItemsControl.ItemContainerStyle>
                        </ItemsControl>
                    </ScrollViewer>
                </TabItem>

                <!-- FOLIAGE -->
                <TabItem Header="Foliage">
                    <ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
                        <ItemsControl ItemsSource="{Binding Map.PrimButtons}"
                                      ItemTemplate="{StaticResource PrimButtonTemplate}">
                            <ItemsControl.ItemsPanel>
                                <ItemsPanelTemplate>
                                    <WrapPanel Orientation="Horizontal"/>
                                </ItemsPanelTemplate>
                            </ItemsControl.ItemsPanel>
                            <ItemsControl.ItemContainerStyle>
                                <Style TargetType="ContentPresenter">
                                    <Setter Property="Visibility" Value="Collapsed"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding Category}" Value="{x:Static models:PrimButtonCategory.Foliage}">
                                            <Setter Property="Visibility" Value="Visible"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </ItemsControl.ItemContainerStyle>
                        </ItemsControl>
                    </ScrollViewer>
                </TabItem>

                <!-- Structures -->
                <TabItem Header="Structures">
                    <ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
                        <ItemsControl ItemsSource="{Binding Map.PrimButtons}"
                                      ItemTemplate="{StaticResource PrimButtonTemplate}">
                            <ItemsControl.ItemsPanel>
                                <ItemsPanelTemplate>
                                    <WrapPanel Orientation="Horizontal"/>
                                </ItemsPanelTemplate>
                            </ItemsControl.ItemsPanel>
                            <ItemsControl.ItemContainerStyle>
                                <Style TargetType="ContentPresenter">
                                    <Setter Property="Visibility" Value="Collapsed"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding Category}" Value="{x:Static models:PrimButtonCategory.Structures}">
                                            <Setter Property="Visibility" Value="Visible"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </ItemsControl.ItemContainerStyle>
                        </ItemsControl>
                    </ScrollViewer>
                </TabItem>

                <!-- SIGNS -->
                <TabItem Header="Signs">
                    <ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
                        <ItemsControl ItemsSource="{Binding Map.PrimButtons}"
                                      ItemTemplate="{StaticResource PrimButtonTemplate}">
                            <ItemsControl.ItemsPanel>
                                <ItemsPanelTemplate>
                                    <WrapPanel Orientation="Horizontal"/>
                                </ItemsPanelTemplate>
                            </ItemsControl.ItemsPanel>
                            <ItemsControl.ItemContainerStyle>
                                <Style TargetType="ContentPresenter">
                                    <Setter Property="Visibility" Value="Collapsed"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding Category}" Value="{x:Static models:PrimButtonCategory.Signs}">
                                            <Setter Property="Visibility" Value="Visible"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </ItemsControl.ItemContainerStyle>
                        </ItemsControl>
                    </ScrollViewer>
                </TabItem>

                <!-- WEAPONS -->
                <TabItem Header="Weapons">
                    <ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
                        <ItemsControl ItemsSource="{Binding Map.PrimButtons}"
                                      ItemTemplate="{StaticResource PrimButtonTemplate}">
                            <ItemsControl.ItemsPanel>
                                <ItemsPanelTemplate>
                                    <WrapPanel Orientation="Horizontal"/>
                                </ItemsPanelTemplate>
                            </ItemsControl.ItemsPanel>
                            <ItemsControl.ItemContainerStyle>
                                <Style TargetType="ContentPresenter">
                                    <Setter Property="Visibility" Value="Collapsed"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding Category}" Value="{x:Static models:PrimButtonCategory.Weapons}">
                                            <Setter Property="Visibility" Value="Visible"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </ItemsControl.ItemContainerStyle>
                        </ItemsControl>
                    </ScrollViewer>
                </TabItem>

                <!-- COLLECTIBLES -->
                <TabItem Header="Collectibles">
                    <ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
                        <ItemsControl ItemsSource="{Binding Map.PrimButtons}"
                                      ItemTemplate="{StaticResource PrimButtonTemplate}">
                            <ItemsControl.ItemsPanel>
                                <ItemsPanelTemplate>
                                    <WrapPanel Orientation="Horizontal"/>
                                </ItemsPanelTemplate>
                            </ItemsControl.ItemsPanel>
                            <ItemsControl.ItemContainerStyle>
                                <Style TargetType="ContentPresenter">
                                    <Setter Property="Visibility" Value="Collapsed"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding Category}" Value="{x:Static models:PrimButtonCategory.Collectibles}">
                                            <Setter Property="Visibility" Value="Visible"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </ItemsControl.ItemContainerStyle>
                        </ItemsControl>
                    </ScrollViewer>
                </TabItem>

                <!-- Lights -->
                <TabItem Header="Lights">
                    <ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
                        <ItemsControl ItemsSource="{Binding Map.PrimButtons}"
                                      ItemTemplate="{StaticResource PrimButtonTemplate}">
                            <ItemsControl.ItemsPanel>
                                <ItemsPanelTemplate>
                                    <WrapPanel Orientation="Horizontal"/>
                                </ItemsPanelTemplate>
                            </ItemsControl.ItemsPanel>
                            <ItemsControl.ItemContainerStyle>
                                <Style TargetType="ContentPresenter">
                                    <Setter Property="Visibility" Value="Collapsed"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding Category}" Value="{x:Static models:PrimButtonCategory.Lights}">
                                            <Setter Property="Visibility" Value="Visible"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </ItemsControl.ItemContainerStyle>
                        </ItemsControl>
                    </ScrollViewer>
                </TabItem>

                <!-- UTILITIES / OTHER -->
                <TabItem Header="Other">
                    <ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
                        <ItemsControl ItemsSource="{Binding Map.PrimButtons}"
                                      ItemTemplate="{StaticResource PrimButtonTemplate}">
                            <ItemsControl.ItemsPanel>
                                <ItemsPanelTemplate>
                                    <WrapPanel Orientation="Horizontal"/>
                                </ItemsPanelTemplate>
                            </ItemsControl.ItemsPanel>
                            <ItemsControl.ItemContainerStyle>
                                <Style TargetType="ContentPresenter">
                                    <Setter Property="Visibility" Value="Collapsed"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding Category}" Value="{x:Static models:PrimButtonCategory.Utilities}">
                                            <Setter Property="Visibility" Value="Visible"/>
                                        </DataTrigger>
                                        <DataTrigger Binding="{Binding Category}" Value="{x:Static models:PrimButtonCategory.Misc}">
                                            <Setter Property="Visibility" Value="Visible"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </ItemsControl.ItemContainerStyle>
                        </ItemsControl>
                    </ScrollViewer>
                </TabItem>
            </TabControl>
        </Border>
    </Grid>
</UserControl>
