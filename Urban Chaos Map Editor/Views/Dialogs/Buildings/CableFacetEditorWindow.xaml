<Window x:Class="UrbanChaosMapEditor.Views.Dialogs.Buildings.CableFacetEditorWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Cable Editor" 
        Width="700" Height="750"
        Background="#202225"
        WindowStartupLocation="CenterOwner"
        ResizeMode="CanResizeWithGrip">

    <Window.Resources>
        <SolidColorBrush x:Key="Fg" Color="White"/>
        <SolidColorBrush x:Key="Subtle" Color="#FFB0B0B0"/>
        <SolidColorBrush x:Key="EditableBg" Color="#2A2D32"/>
        <SolidColorBrush x:Key="EditableBorder" Color="#4A4D52"/>
        <SolidColorBrush x:Key="ReadOnlyBg" Color="#1A1D20"/>
        <SolidColorBrush x:Key="CableColor" Color="#FF4444"/>

        <Style TargetType="TextBlock">
            <Setter Property="Foreground" Value="{StaticResource Fg}"/>
        </Style>

        <Style x:Key="EditableField" TargetType="TextBox">
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="Background" Value="{StaticResource EditableBg}"/>
            <Setter Property="BorderBrush" Value="{StaticResource EditableBorder}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="6,4"/>
            <Setter Property="Width" Value="70"/>
            <Setter Property="HorizontalContentAlignment" Value="Center"/>
        </Style>

        <Style x:Key="ReadOnlyField" TargetType="TextBox" BasedOn="{StaticResource EditableField}">
            <Setter Property="Background" Value="{StaticResource ReadOnlyBg}"/>
            <Setter Property="IsReadOnly" Value="True"/>
            <Setter Property="Foreground" Value="#888"/>
        </Style>

        <Style x:Key="FieldLabel" TargetType="TextBlock">
            <Setter Property="Foreground" Value="{StaticResource Subtle}"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
            <Setter Property="Width" Value="100"/>
        </Style>

        <Style x:Key="ActionButton" TargetType="Button">
            <Setter Property="Background" Value="#3A3D42"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderBrush" Value="#555"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="16,10"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="MinWidth" Value="100"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#4A4D52"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <Style x:Key="SaveButton" TargetType="Button" BasedOn="{StaticResource ActionButton}">
            <Setter Property="Background" Value="#205C27"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#307C37"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <Style x:Key="DeleteButton" TargetType="Button" BasedOn="{StaticResource ActionButton}">
            <Setter Property="Background" Value="#5C2020"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#7C3030"/>
                </Trigger>
            </Style.Triggers>
        </Style>
    </Window.Resources>

    <Grid Margin="16">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <StackPanel Grid.Row="0" Margin="0,0,0,12">
            <TextBlock x:Name="TxtHeader" Text="Cable Editor - Facet #123" FontWeight="Bold" FontSize="16"/>
            <TextBlock x:Name="TxtFacetId" Text="Facet ID: 123" Foreground="{StaticResource Subtle}" FontSize="11"/>
        </StackPanel>

        <!-- Coordinates Section -->
        <Border Grid.Row="1" BorderBrush="#333" BorderThickness="1" CornerRadius="6" Padding="12" Margin="0,0,0,12">
            <StackPanel>
                <TextBlock Text="Cable Endpoints" FontWeight="SemiBold" Margin="0,0,0,8"/>

                <!-- Start Point -->
                <StackPanel Orientation="Horizontal" Margin="0,4,0,4">
                    <TextBlock Text="Start Point:" Style="{StaticResource FieldLabel}"/>
                    <TextBlock Text="X:" VerticalAlignment="Center" Margin="0,0,4,0"/>
                    <TextBox x:Name="TxtX0" Style="{StaticResource EditableField}" Width="60"
                             TextChanged="Field_TextChanged" PreviewTextInput="NumericOnly_PreviewTextInput"/>
                    <TextBlock Text="Z:" VerticalAlignment="Center" Margin="12,0,4,0"/>
                    <TextBox x:Name="TxtZ0" Style="{StaticResource EditableField}" Width="60"
                             TextChanged="Field_TextChanged" PreviewTextInput="NumericOnly_PreviewTextInput"/>
                    <TextBlock Text="Y:" VerticalAlignment="Center" Margin="12,0,4,0"/>
                    <TextBox x:Name="TxtY0" Style="{StaticResource EditableField}" Width="80"
                             TextChanged="Field_TextChanged" PreviewTextInput="SignedNumericOnly_PreviewTextInput"/>
                </StackPanel>

                <!-- End Point -->
                <StackPanel Orientation="Horizontal" Margin="0,4,0,0">
                    <TextBlock Text="End Point:" Style="{StaticResource FieldLabel}"/>
                    <TextBlock Text="X:" VerticalAlignment="Center" Margin="0,0,4,0"/>
                    <TextBox x:Name="TxtX1" Style="{StaticResource EditableField}" Width="60"
                             TextChanged="Field_TextChanged" PreviewTextInput="NumericOnly_PreviewTextInput"/>
                    <TextBlock Text="Z:" VerticalAlignment="Center" Margin="12,0,4,0"/>
                    <TextBox x:Name="TxtZ1" Style="{StaticResource EditableField}" Width="60"
                             TextChanged="Field_TextChanged" PreviewTextInput="NumericOnly_PreviewTextInput"/>
                    <TextBlock Text="Y:" VerticalAlignment="Center" Margin="12,0,4,0"/>
                    <TextBox x:Name="TxtY1" Style="{StaticResource EditableField}" Width="80"
                             TextChanged="Field_TextChanged" PreviewTextInput="SignedNumericOnly_PreviewTextInput"/>
                </StackPanel>

                <!-- Calculated Info -->
                <StackPanel Orientation="Horizontal" Margin="0,8,0,0">
                    <TextBlock Text="Horizontal:" Style="{StaticResource FieldLabel}"/>
                    <TextBlock x:Name="TxtCalculatedLength" Text="16 tiles" Foreground="#88FF88"/>
                    <TextBlock Text="Height Δ:" Margin="24,0,8,0" Foreground="{StaticResource Subtle}"/>
                    <TextBlock x:Name="TxtHeightDelta" Text="0" Foreground="#88FF88"/>
                </StackPanel>
            </StackPanel>
        </Border>

        <!-- Cable Parameters Section -->
        <Border Grid.Row="2" BorderBrush="#333" BorderThickness="1" CornerRadius="6" Padding="12" Margin="0,0,0,12">
            <StackPanel>
                <TextBlock Text="Cable Parameters" FontWeight="SemiBold" Margin="0,0,0,8"/>

                <!-- Segments -->
                <StackPanel Orientation="Horizontal" Margin="0,4,0,4">
                    <TextBlock Text="Segments:" Style="{StaticResource FieldLabel}"/>
                    <TextBox x:Name="TxtSegments" Style="{StaticResource EditableField}" Width="60"
                             TextChanged="Field_TextChanged" PreviewTextInput="NumericOnly_PreviewTextInput"/>
                    <TextBlock Text="(number of cable sections)" Foreground="{StaticResource Subtle}" 
                               VerticalAlignment="Center" Margin="8,0,0,0" FontSize="11"/>
                    <Button Content="Auto" Padding="8,2" Margin="12,0,0,0" 
                            Background="#2A3A4A" Foreground="White" BorderBrush="#3A5A7A"
                            Click="BtnAutoSegments_Click" ToolTip="Calculate optimal segment count from length"/>
                </StackPanel>

                <!-- Step Angles -->
                <Border Background="#1A1D20" CornerRadius="4" Padding="12" Margin="0,8,0,0">
                    <StackPanel>
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Text="Step Angles (control cable sag/curve):" 
                                       Foreground="{StaticResource Subtle}" FontSize="11"/>
                            <Button Grid.Column="1" Content="Auto Calculate" Padding="8,2"
                                    Background="#2A3A4A" Foreground="White" BorderBrush="#3A5A7A"
                                    Click="BtnAutoAngles_Click" ToolTip="Calculate optimal angles based on geometry"/>
                        </Grid>

                        <!-- Step Angle 1 -->
                        <StackPanel Orientation="Horizontal" Margin="0,8,0,4">
                            <TextBlock Text="Step Angle 1:" Style="{StaticResource FieldLabel}"/>
                            <TextBox x:Name="TxtStepAngle1" Style="{StaticResource EditableField}" Width="80"
                                     TextChanged="Field_TextChanged" PreviewTextInput="SignedNumericOnly_PreviewTextInput"/>
                            <TextBlock Text="(curve at start, typically positive)" 
                                       Foreground="{StaticResource Subtle}" VerticalAlignment="Center" Margin="8,0,0,0" FontSize="11"/>
                        </StackPanel>

                        <!-- Step Angle 2 -->
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,4">
                            <TextBlock Text="Step Angle 2:" Style="{StaticResource FieldLabel}"/>
                            <TextBox x:Name="TxtStepAngle2" Style="{StaticResource EditableField}" Width="80"
                                     TextChanged="Field_TextChanged" PreviewTextInput="SignedNumericOnly_PreviewTextInput"/>
                            <TextBlock Text="(curve at end, typically negative)" 
                                       Foreground="{StaticResource Subtle}" VerticalAlignment="Center" Margin="8,0,0,0" FontSize="11"/>
                        </StackPanel>

                        <TextBlock Text="For flat cables: angle1 ≈ 1024/segments, angle2 ≈ -angle1" 
                                   Foreground="#666644" FontSize="10" Margin="0,4,0,0" FontStyle="Italic"/>
                    </StackPanel>
                </Border>

                <!-- Other Fields -->
                <StackPanel Orientation="Horizontal" Margin="0,12,0,0">
                    <TextBlock Text="FHeight:" Style="{StaticResource FieldLabel}" Width="80"/>
                    <TextBox x:Name="TxtFHeight" Style="{StaticResource EditableField}" Width="60"
                             TextChanged="Field_TextChanged" PreviewTextInput="NumericOnly_PreviewTextInput"/>
                    <TextBlock Text="(texture style, usually 2)" 
                               Foreground="{StaticResource Subtle}" VerticalAlignment="Center" Margin="8,0,0,0" FontSize="11"/>
                </StackPanel>

                <StackPanel Orientation="Horizontal" Margin="0,4,0,0">
                    <TextBlock Text="Flags:" Style="{StaticResource FieldLabel}" Width="80"/>
                    <TextBox x:Name="TxtFlags" Style="{StaticResource ReadOnlyField}" Width="100"/>
                    <TextBlock Text="(always Unclimbable for cables)" 
                               Foreground="{StaticResource Subtle}" VerticalAlignment="Center" Margin="8,0,0,0" FontSize="11"/>
                </StackPanel>
            </StackPanel>
        </Border>

        <!-- Raw Data (collapsed by default) -->
        <Expander Grid.Row="3" Header="Raw Data" Foreground="{StaticResource Subtle}" Margin="0,0,0,12">
            <Border Background="#1A1D20" CornerRadius="4" Padding="8" Margin="0,4,0,0">
                <StackPanel>
                    <TextBlock x:Name="TxtRawHex" Text="Raw bytes: ..." FontFamily="Consolas" FontSize="11" 
                               Foreground="#888" TextWrapping="Wrap"/>
                </StackPanel>
            </Border>
        </Expander>

        <!-- Live Preview -->
        <Border Grid.Row="4" BorderBrush="#333" BorderThickness="1" CornerRadius="6" Padding="8" Margin="0,0,0,12">
            <DockPanel>
                <TextBlock DockPanel.Dock="Top" Text="Preview (Side View)" FontWeight="SemiBold" Margin="0,0,0,8"/>
                <Border Background="#1A1D20" CornerRadius="4">
                    <Canvas x:Name="PreviewCanvas" 
                            ClipToBounds="True"
                            MinHeight="150"
                            SizeChanged="PreviewCanvas_SizeChanged"/>
                </Border>
            </DockPanel>
        </Border>

        <!-- Buttons -->
        <Grid Grid.Row="5">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <Button Grid.Column="0" Content="🗑️ Delete Cable" Style="{StaticResource DeleteButton}" 
                    Click="BtnDelete_Click" ToolTip="Delete this cable from the map"/>

            <StackPanel Grid.Column="2" Orientation="Horizontal">
                <Button Content="Close" Style="{StaticResource ActionButton}" Click="BtnClose_Click" Margin="0,0,8,0"/>
                <Button x:Name="BtnSave" Content="💾 Save Changes" Style="{StaticResource SaveButton}" 
                        Click="BtnSave_Click" IsEnabled="False"/>
            </StackPanel>
        </Grid>
    </Grid>
</Window>
