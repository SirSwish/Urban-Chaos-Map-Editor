<Window x:Class="UrbanChaosMapEditor.Views.Dialogs.Buildings.FacetPainterWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Paint Facet" Width="1200" Height="800"
        Background="#202225"
        WindowStartupLocation="CenterOwner"
        ResizeMode="CanResize">

    <Window.Resources>
        <SolidColorBrush x:Key="Fg" Color="White"/>
        <SolidColorBrush x:Key="Subtle" Color="#FFB0B0B0"/>
        <SolidColorBrush x:Key="EditableBg" Color="#2A2D32"/>
        <SolidColorBrush x:Key="EditableBorder" Color="#4A4D52"/>
        <SolidColorBrush x:Key="SelectedBorder" Color="#FFD700"/>
        <SolidColorBrush x:Key="PaintedCellBorder" Color="#00FF00"/>

        <Style TargetType="TextBlock">
            <Setter Property="Foreground" Value="{StaticResource Fg}"/>
        </Style>

        <Style x:Key="ActionButton" TargetType="Button">
            <Setter Property="Background" Value="#3A3D42"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderBrush" Value="#555"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="12,6"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#4A4D52"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <Style x:Key="PaletteItem" TargetType="Border">
            <Setter Property="BorderThickness" Value="2"/>
            <Setter Property="BorderBrush" Value="Transparent"/>
            <Setter Property="Margin" Value="2"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Background" Value="#2A2D32"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="BorderBrush" Value="#888"/>
                </Trigger>
                <DataTrigger Binding="{Binding IsSelected}" Value="True">
                    <Setter Property="BorderBrush" Value="{StaticResource SelectedBorder}"/>
                </DataTrigger>
            </Style.Triggers>
        </Style>
    </Window.Resources>

    <Grid Margin="12">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="320"/>
            <ColumnDefinition Width="12"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>
        <Grid.RowDefinitions>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- LEFT: Texture Palette -->
        <Border Grid.Column="0" Grid.Row="0" BorderThickness="1" BorderBrush="#333" CornerRadius="6" Padding="8">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- Header -->
                <TextBlock Grid.Row="0" Text="Texture Palette" FontWeight="Bold" FontSize="14" Margin="0,0,0,8"/>

                <!-- Selected texture info -->
                <Border Grid.Row="1" Background="#2A2D32" CornerRadius="4" Padding="8" Margin="0,0,0,8">
                    <StackPanel>
                        <TextBlock Text="Selected Texture:" FontWeight="SemiBold" Margin="0,0,0,4"/>
                        <StackPanel Orientation="Horizontal">
                            <Border x:Name="SelectedTexturePreview" Width="64" Height="64" 
                                    BorderBrush="{StaticResource SelectedBorder}" BorderThickness="2" 
                                    Background="#1E1F22"/>
                            <StackPanel Margin="12,0,0,0" VerticalAlignment="Center">
                                <TextBlock x:Name="SelectedTextureLabel" Text="(none)" FontSize="14"/>
                                <CheckBox x:Name="ChkFlipHorizontal" Content="Flip Horizontal" 
                                          Foreground="White" Margin="0,8,0,0"/>
                            </StackPanel>
                        </StackPanel>
                    </StackPanel>
                </Border>

                <!-- Texture grid -->
                <ScrollViewer Grid.Row="2" VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
                    <ItemsControl x:Name="TexturePalette">
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <WrapPanel Orientation="Horizontal"/>
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Border Style="{StaticResource PaletteItem}" 
                                        Tag="{Binding Index}"
                                        MouseLeftButtonDown="PaletteItem_Click"
                                        ToolTip="{Binding TooltipText}">
                                    <Image Width="32" Height="32" Source="{Binding Thumbnail}" 
                                           RenderOptions.BitmapScalingMode="NearestNeighbor"/>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </ScrollViewer>

                <!-- Clear button -->
                <StackPanel Grid.Row="3" Orientation="Horizontal" Margin="0,8,0,0">
                    <Button x:Name="BtnSelectEraser" Content="🧹 Eraser (Use Base Style)" 
                            Style="{StaticResource ActionButton}" Click="BtnSelectEraser_Click"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- RIGHT: Facet Preview Grid -->
        <Border Grid.Column="2" Grid.Row="0" BorderThickness="1" BorderBrush="#333" CornerRadius="6" Padding="8">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <!-- Header -->
                <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,8">
                    <TextBlock Text="Facet Preview" FontWeight="Bold" FontSize="14"/>
                    <TextBlock x:Name="FacetDimensionsText" Margin="12,0,0,0" 
                               Foreground="{StaticResource Subtle}" VerticalAlignment="Center"/>
                </StackPanel>

                <!-- Instructions -->
                <TextBlock Grid.Row="1" Margin="0,0,0,8" Foreground="{StaticResource Subtle}" TextWrapping="Wrap">
                    Click a texture in the palette, then click cells in the preview to paint. 
                    Right-click a cell to clear it (use base style). Green border = painted cell.
                </TextBlock>

                <!-- Canvas for facet preview -->
                <ScrollViewer Grid.Row="2" x:Name="PreviewScroll" 
                              HorizontalScrollBarVisibility="Auto" 
                              VerticalScrollBarVisibility="Auto" 
                              Background="#1E1F22">
                    <Grid>
                        <Canvas x:Name="PanelCanvas" Background="#202225" 
                                SnapsToDevicePixels="True" ClipToBounds="True"
                                MouseLeftButtonDown="PanelCanvas_MouseLeftButtonDown"
                                MouseRightButtonDown="PanelCanvas_MouseRightButtonDown"/>
                        <Canvas x:Name="GridCanvas" IsHitTestVisible="False"/>
                    </Grid>
                </ScrollViewer>
            </Grid>
        </Border>

        <!-- Bottom buttons -->
        <StackPanel Grid.Column="0" Grid.ColumnSpan="3" Grid.Row="1" 
                    Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,12,0,0">
            <Button x:Name="BtnClearAll" Content="Clear All Paint" 
                    Style="{StaticResource ActionButton}" Click="BtnClearAll_Click" Margin="0,0,8,0"/>
            <Button x:Name="BtnCancel" Content="Cancel" 
                    Style="{StaticResource ActionButton}" Click="BtnCancel_Click" Margin="0,0,8,0"/>
            <Button x:Name="BtnSave" Content="Save Changes" 
                    Style="{StaticResource ActionButton}" Click="BtnSave_Click"
                    Background="#2D5A2D" BorderBrush="#3D7A3D"/>
        </StackPanel>
    </Grid>
</Window>
