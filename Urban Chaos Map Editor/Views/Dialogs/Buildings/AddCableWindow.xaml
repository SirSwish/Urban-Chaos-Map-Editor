<Window x:Class="UrbanChaosMapEditor.Views.Dialogs.Buildings.AddCableWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Add Cable" 
        Width="650" Height="700"
        Background="#202225"
        WindowStartupLocation="CenterOwner"
        ResizeMode="CanResizeWithGrip">

    <Window.Resources>
        <SolidColorBrush x:Key="Fg" Color="White"/>
        <SolidColorBrush x:Key="Subtle" Color="#FFB0B0B0"/>
        <SolidColorBrush x:Key="EditableBg" Color="#2A2D32"/>
        <SolidColorBrush x:Key="EditableBorder" Color="#4A4D52"/>
        <SolidColorBrush x:Key="CableColor" Color="#FF4444"/>

        <Style TargetType="TextBlock">
            <Setter Property="Foreground" Value="{StaticResource Fg}"/>
        </Style>

        <Style x:Key="EditableField" TargetType="TextBox">
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="Background" Value="{StaticResource EditableBg}"/>
            <Setter Property="BorderBrush" Value="{StaticResource EditableBorder}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="6,4"/>
            <Setter Property="Width" Value="70"/>
            <Setter Property="HorizontalContentAlignment" Value="Center"/>
        </Style>

        <Style x:Key="FieldLabel" TargetType="TextBlock">
            <Setter Property="Foreground" Value="{StaticResource Subtle}"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
            <Setter Property="Width" Value="100"/>
        </Style>

        <Style x:Key="ActionButton" TargetType="Button">
            <Setter Property="Background" Value="#3A3D42"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderBrush" Value="#555"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="16,10"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="MinWidth" Value="100"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#4A4D52"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <Style x:Key="PrimaryButton" TargetType="Button" BasedOn="{StaticResource ActionButton}">
            <Setter Property="Background" Value="#5A2020"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#7A3030"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <Style x:Key="DrawButton" TargetType="Button" BasedOn="{StaticResource ActionButton}">
            <Setter Property="Background" Value="#2D4A5A"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#3D6A7A"/>
                </Trigger>
            </Style.Triggers>
        </Style>
    </Window.Resources>

    <Grid Margin="16">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <TextBlock Grid.Row="0" Text="Add New Cable" FontWeight="Bold" FontSize="16" Margin="0,0,0,12"/>

        <!-- Coordinates Section -->
        <Border Grid.Row="1" BorderBrush="#333" BorderThickness="1" CornerRadius="6" Padding="12" Margin="0,0,0,12">
            <StackPanel>
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <TextBlock Text="Cable Endpoints" FontWeight="SemiBold" Margin="0,0,0,8"/>

                    <Button Grid.Column="1" 
                            Content="📍 Draw on Map" 
                            Style="{StaticResource DrawButton}"
                            Padding="8,4"
                            Click="BtnDrawOnMap_Click"
                            ToolTip="Click two points on the map to set cable start and end"/>
                </Grid>

                <!-- Start Point -->
                <StackPanel Orientation="Horizontal" Margin="0,8,0,4">
                    <TextBlock Text="Start Point:" Style="{StaticResource FieldLabel}"/>
                    <TextBlock Text="X:" VerticalAlignment="Center" Margin="0,0,4,0"/>
                    <TextBox x:Name="TxtX0" Style="{StaticResource EditableField}" Width="60" Text="64"
                             TextChanged="Coordinate_TextChanged" PreviewTextInput="NumericOnly_PreviewTextInput"/>
                    <TextBlock Text="Z:" VerticalAlignment="Center" Margin="12,0,4,0"/>
                    <TextBox x:Name="TxtZ0" Style="{StaticResource EditableField}" Width="60" Text="64"
                             TextChanged="Coordinate_TextChanged" PreviewTextInput="NumericOnly_PreviewTextInput"/>
                    <TextBlock Text="Y:" VerticalAlignment="Center" Margin="12,0,4,0"/>
                    <TextBox x:Name="TxtY0" Style="{StaticResource EditableField}" Width="70" Text="512"
                             TextChanged="Coordinate_TextChanged" PreviewTextInput="SignedNumericOnly_PreviewTextInput"/>
                </StackPanel>

                <!-- End Point -->
                <StackPanel Orientation="Horizontal" Margin="0,4,0,0">
                    <TextBlock Text="End Point:" Style="{StaticResource FieldLabel}"/>
                    <TextBlock Text="X:" VerticalAlignment="Center" Margin="0,0,4,0"/>
                    <TextBox x:Name="TxtX1" Style="{StaticResource EditableField}" Width="60" Text="80"
                             TextChanged="Coordinate_TextChanged" PreviewTextInput="NumericOnly_PreviewTextInput"/>
                    <TextBlock Text="Z:" VerticalAlignment="Center" Margin="12,0,4,0"/>
                    <TextBox x:Name="TxtZ1" Style="{StaticResource EditableField}" Width="60" Text="64"
                             TextChanged="Coordinate_TextChanged" PreviewTextInput="NumericOnly_PreviewTextInput"/>
                    <TextBlock Text="Y:" VerticalAlignment="Center" Margin="12,0,4,0"/>
                    <TextBox x:Name="TxtY1" Style="{StaticResource EditableField}" Width="70" Text="512"
                             TextChanged="Coordinate_TextChanged" PreviewTextInput="SignedNumericOnly_PreviewTextInput"/>
                </StackPanel>

                <!-- Calculated Info -->
                <StackPanel Orientation="Horizontal" Margin="0,8,0,0">
                    <TextBlock Text="Length:" Style="{StaticResource FieldLabel}"/>
                    <TextBlock x:Name="TxtCalculatedLength" Text="16 tiles" Foreground="#88FF88"/>
                    <TextBlock Text="Segments:" Margin="24,0,8,0" Foreground="{StaticResource Subtle}"/>
                    <TextBlock x:Name="TxtCalculatedSegments" Text="34" Foreground="#88FF88"/>
                </StackPanel>
            </StackPanel>
        </Border>

        <!-- Cable Parameters Section -->
        <Border Grid.Row="2" BorderBrush="#333" BorderThickness="1" CornerRadius="6" Padding="12" Margin="0,0,0,12">
            <StackPanel>
                <TextBlock Text="Cable Parameters" FontWeight="SemiBold" Margin="0,0,0,8"/>

                <!-- Segments (auto-calculated but editable) -->
                <StackPanel Orientation="Horizontal" Margin="0,4,0,4">
                    <TextBlock Text="Segments:" Style="{StaticResource FieldLabel}"/>
                    <TextBox x:Name="TxtSegments" Style="{StaticResource EditableField}" Width="60" Text="34"
                             TextChanged="Parameter_TextChanged" PreviewTextInput="NumericOnly_PreviewTextInput"/>
                    <TextBlock Text="(number of cable sections)" Foreground="{StaticResource Subtle}" 
                               VerticalAlignment="Center" Margin="8,0,0,0" FontSize="11"/>
                </StackPanel>

                <!-- Advanced Toggle -->
                <CheckBox x:Name="ChkAdvanced" Content="Advanced: Manual Step Angles" 
                          Foreground="{StaticResource Subtle}" Margin="0,8,0,4"
                          Checked="ChkAdvanced_Changed" Unchecked="ChkAdvanced_Changed"/>

                <!-- Advanced Panel (hidden by default) -->
                <StackPanel x:Name="PanelAdvanced" Visibility="Collapsed" Margin="0,8,0,0">
                    <Border Background="#1A1D20" CornerRadius="4" Padding="12">
                        <StackPanel>
                            <TextBlock Text="Step Angles control the cable's sag/curve shape:" 
                                       Foreground="{StaticResource Subtle}" FontSize="11" Margin="0,0,0,8"/>

                            <!-- Step Angle 1 -->
                            <StackPanel Orientation="Horizontal" Margin="0,0,0,4">
                                <TextBlock Text="Step Angle 1:" Style="{StaticResource FieldLabel}"/>
                                <TextBox x:Name="TxtStepAngle1" Style="{StaticResource EditableField}" Width="70" Text="30"
                                         TextChanged="Parameter_TextChanged" PreviewTextInput="SignedNumericOnly_PreviewTextInput"/>
                                <TextBlock Text="(controls curve at start, typically positive)" 
                                           Foreground="{StaticResource Subtle}" VerticalAlignment="Center" Margin="8,0,0,0" FontSize="11"/>
                            </StackPanel>

                            <!-- Step Angle 2 -->
                            <StackPanel Orientation="Horizontal" Margin="0,0,0,4">
                                <TextBlock Text="Step Angle 2:" Style="{StaticResource FieldLabel}"/>
                                <TextBox x:Name="TxtStepAngle2" Style="{StaticResource EditableField}" Width="70" Text="-30"
                                         TextChanged="Parameter_TextChanged" PreviewTextInput="SignedNumericOnly_PreviewTextInput"/>
                                <TextBlock Text="(controls curve at end, typically negative)" 
                                           Foreground="{StaticResource Subtle}" VerticalAlignment="Center" Margin="8,0,0,0" FontSize="11"/>
                            </StackPanel>

                            <TextBlock Text="For flat cables: angle1 ≈ 1024/segments, angle2 ≈ -angle1" 
                                       Foreground="#888844" FontSize="10" Margin="0,8,0,0" FontStyle="Italic"/>
                            <TextBlock Text="For sloped cables: angles are adjusted based on height difference" 
                                       Foreground="#888844" FontSize="10" FontStyle="Italic"/>
                        </StackPanel>
                    </Border>
                </StackPanel>
            </StackPanel>
        </Border>

        <!-- Info Panel -->
        <Border Grid.Row="3" BorderBrush="#443333" Background="#1A1515" BorderThickness="1" CornerRadius="6" Padding="12" Margin="0,0,0,12">
            <StackPanel>
                <TextBlock Text="〰️ About Cables" FontWeight="SemiBold" Foreground="#FF6666" Margin="0,0,0,8"/>
                <TextBlock TextWrapping="Wrap" Foreground="{StaticResource Subtle}" FontSize="11">
                    • Cables are visual elements that hang between two points
                    <LineBreak/>
                    • They use a catenary curve (like a hanging chain)
                    <LineBreak/>
                    • Coordinates are in tile units (0-127), Y is world height
                    <LineBreak/>
                    • Step angles are auto-calculated for realistic sag, but can be manually tweaked
                    <LineBreak/>
                    • Cables are flagged as Unclimbable by default
                </TextBlock>
            </StackPanel>
        </Border>

        <!-- Live Preview -->
        <Border Grid.Row="4" BorderBrush="#333" BorderThickness="1" CornerRadius="6" Padding="8" Margin="0,0,0,12">
            <DockPanel>
                <TextBlock DockPanel.Dock="Top" Text="Preview" FontWeight="SemiBold" Margin="0,0,0,8"/>
                <Border Background="#1A1D20" CornerRadius="4">
                    <Canvas x:Name="PreviewCanvas" 
                            ClipToBounds="True"
                            MinHeight="150"/>
                </Border>
            </DockPanel>
        </Border>

        <!-- Buttons -->
        <StackPanel Grid.Row="5" Orientation="Horizontal" HorizontalAlignment="Right">
            <Button Content="Cancel" Style="{StaticResource ActionButton}" Click="BtnCancel_Click" Margin="0,0,8,0"/>
            <Button x:Name="BtnCreate" Content="〰️ Create Cable" Style="{StaticResource PrimaryButton}" Click="BtnCreate_Click"/>
        </StackPanel>
    </Grid>
</Window>
